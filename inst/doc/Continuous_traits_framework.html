<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Camille Magneville" />

<meta name="date" content="2023-09-07" />

<title>Continuous Traits Framework</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Continuous Traits Framework</h1>
<h4 class="author">Camille Magneville</h4>
<h4 class="date">2023-09-07</h4>



<div id="about-this-tutorial" class="section level1">
<h1>About this tutorial</h1>
<p><br /></p>
<p>This tutorial explains the workflow used to compute functional space
based on continuous traits and it shows how to retrieve species
coordinates and species functional distances in the functional
space.</p>
<p><br /></p>
<p><strong>DATA</strong> This tutorial uses a dataset from one of the 80
CESTES database Jeliazkov &amp; the CESTES consortium (2019)) based on
[Villeger <em>et al.</em> 2012] (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0040679" class="uri">https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0040679</a>).
This data frame contains 45 fish species from the Terminos Lagoon (Gulf
of Mexico) gathered into 36 sites considered as assemblages. Each
species is described with 16 continuous morphological traits.</p>
<p><br /></p>
<p>When the dataset <strong>only</strong> gathers continuous traits, the
functional space can be computed using one trait for one dimension or
using Principal Component Analysis (PCA: convert correlations among
samples into a 2D plot). <strong>NB</strong> Using a PCoA on continuous
traits and euclidean distance is the same than using a PCA (clusters
made by minimizing the linear distance (PCoA) are the same as those
obtained by maximizing linear correlations (PCA)).</p>
<p><br /></p>
</div>
<div id="load-dataset" class="section level1">
<h1>1. Load dataset</h1>
<p><br /></p>
<p>The species traits data frame has rows corresponding to species and
columns corresponding to traits. The different traits are summed up in
the following table:</p>
<p><br /></p>
<table>
<thead>
<tr class="header">
<th align="center">Trait name</th>
<th align="center">Trait signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">logM</td>
<td align="center">log(mass)</td>
</tr>
<tr class="even">
<td align="center">Ogsf</td>
<td align="center">Oral gape surface</td>
</tr>
<tr class="odd">
<td align="center">OgSh</td>
<td align="center">Oral gape shape</td>
</tr>
<tr class="even">
<td align="center">OgPo</td>
<td align="center">Oral gape position</td>
</tr>
<tr class="odd">
<td align="center">GrLg</td>
<td align="center">Gill raker length</td>
</tr>
<tr class="even">
<td align="center">GtLg</td>
<td align="center">Gut length</td>
</tr>
<tr class="odd">
<td align="center">EySz</td>
<td align="center">Eye size</td>
</tr>
<tr class="even">
<td align="center">EyPo</td>
<td align="center">Eye position</td>
</tr>
<tr class="odd">
<td align="center">BdSh</td>
<td align="center">Body transversal shape</td>
</tr>
<tr class="even">
<td align="center">BdSf</td>
<td align="center">Body transversal surface</td>
</tr>
<tr class="odd">
<td align="center">PfPo</td>
<td align="center">Pectoral fin position</td>
</tr>
<tr class="even">
<td align="center">PfSh</td>
<td align="center">Aspect ratio of the pectoral fin</td>
</tr>
<tr class="odd">
<td align="center">CpHt</td>
<td align="center">Caudal peduncle throttling</td>
</tr>
<tr class="even">
<td align="center">CfSh</td>
<td align="center">Aspect ratio of the caudal fin</td>
</tr>
<tr class="odd">
<td align="center">FsRt</td>
<td align="center">Fins surface ratio</td>
</tr>
<tr class="even">
<td align="center">FsSf</td>
<td align="center">Fins surface to body size ratio</td>
</tr>
</tbody>
</table>
<p><br /></p>
<p>To work with <code>mFD</code> with only continuous traits, you must
load two objects:</p>
<p><br /></p>
<ul>
<li><code>sp_tr</code>: species x traits data frame</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># load dataset:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>sp_tr <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;data_cestes_sp_tr.csv&quot;</span>, </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                              <span class="at">package =</span> <span class="st">&quot;mFD&quot;</span>), <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">rownames</span>(sp_tr) <span class="ot">&lt;-</span> sp_tr<span class="sc">$</span><span class="st">&quot;Sp&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>sp_tr <span class="ot">&lt;-</span> sp_tr[ , <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># display the table:</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(sp_tr), </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Species x Traits data frame based on *CESTES* dataset&quot;</span>)</span></code></pre></div>
<table style="width:100%;">
<caption>Species x Traits data frame based on <em>CESTES</em>
dataset</caption>
<colgroup>
<col width="22%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">logM</th>
<th align="right">OgSf</th>
<th align="right">OgSh</th>
<th align="right">OgPo</th>
<th align="right">EySz</th>
<th align="right">GrLg</th>
<th align="right">GtLg</th>
<th align="right">EyPo</th>
<th align="right">BdSh</th>
<th align="right">BdSf</th>
<th align="right">PfPo</th>
<th align="right">PfSh</th>
<th align="right">CpHt</th>
<th align="right">CfSh</th>
<th align="right">FsRt</th>
<th align="right">FsSf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Achirus_lineatus</td>
<td align="right">2.187</td>
<td align="right">0.072</td>
<td align="right">0.947</td>
<td align="right">1.000</td>
<td align="right">0.151</td>
<td align="right">0.000</td>
<td align="right">1.782</td>
<td align="right">1.000</td>
<td align="right">0.143</td>
<td align="right">2.168</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">1.121</td>
<td align="right">0.767</td>
<td align="right">0.000</td>
<td align="right">1.158</td>
</tr>
<tr class="even">
<td align="left">Anchoa_mitchilli</td>
<td align="right">0.706</td>
<td align="right">0.283</td>
<td align="right">2.054</td>
<td align="right">0.508</td>
<td align="right">0.474</td>
<td align="right">0.381</td>
<td align="right">0.688</td>
<td align="right">0.584</td>
<td align="right">3.292</td>
<td align="right">3.974</td>
<td align="right">0.773</td>
<td align="right">2.708</td>
<td align="right">2.493</td>
<td align="right">3.108</td>
<td align="right">0.504</td>
<td align="right">2.618</td>
</tr>
<tr class="odd">
<td align="left">Archosargus_probatocephalus</td>
<td align="right">2.674</td>
<td align="right">0.082</td>
<td align="right">0.754</td>
<td align="right">0.221</td>
<td align="right">0.282</td>
<td align="right">0.035</td>
<td align="right">2.591</td>
<td align="right">0.652</td>
<td align="right">3.091</td>
<td align="right">1.679</td>
<td align="right">0.666</td>
<td align="right">4.740</td>
<td align="right">2.584</td>
<td align="right">2.393</td>
<td align="right">1.526</td>
<td align="right">1.504</td>
</tr>
<tr class="even">
<td align="left">Archosargus_rhomboidalis</td>
<td align="right">3.327</td>
<td align="right">0.056</td>
<td align="right">0.648</td>
<td align="right">0.273</td>
<td align="right">0.294</td>
<td align="right">0.032</td>
<td align="right">3.467</td>
<td align="right">0.647</td>
<td align="right">3.102</td>
<td align="right">1.596</td>
<td align="right">0.638</td>
<td align="right">6.868</td>
<td align="right">2.906</td>
<td align="right">2.684</td>
<td align="right">1.060</td>
<td align="right">1.502</td>
</tr>
<tr class="odd">
<td align="left">Ariopsis_felis</td>
<td align="right">3.110</td>
<td align="right">0.173</td>
<td align="right">0.513</td>
<td align="right">0.346</td>
<td align="right">0.263</td>
<td align="right">0.128</td>
<td align="right">2.078</td>
<td align="right">0.647</td>
<td align="right">1.021</td>
<td align="right">1.658</td>
<td align="right">0.806</td>
<td align="right">3.480</td>
<td align="right">3.592</td>
<td align="right">4.052</td>
<td align="right">0.781</td>
<td align="right">1.648</td>
</tr>
<tr class="even">
<td align="left">Bagre_marinus</td>
<td align="right">2.170</td>
<td align="right">0.248</td>
<td align="right">0.519</td>
<td align="right">0.489</td>
<td align="right">0.357</td>
<td align="right">0.142</td>
<td align="right">2.154</td>
<td align="right">0.613</td>
<td align="right">1.016</td>
<td align="right">2.087</td>
<td align="right">0.662</td>
<td align="right">3.674</td>
<td align="right">4.205</td>
<td align="right">3.460</td>
<td align="right">0.625</td>
<td align="right">1.678</td>
</tr>
</tbody>
</table>
<p><br /></p>
<ul>
<li><code>asb_sp_w</code>: species x assemblages data frame summarizing
biomass recorded in a volume of 4500m<sup>3</sup> per site and per
species:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># load dataset:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>asb_sp_w <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;data_cestes_asb_sp_w.csv&quot;</span>, </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                                 <span class="at">package =</span> <span class="st">&quot;mFD&quot;</span>), <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">rownames</span>(asb_sp_w) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;site&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, asb_sp_w<span class="sc">$</span>Sites)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>asb_sp_w <span class="ot">&lt;-</span> asb_sp_w[ , <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>asb_sp_w<span class="sc">$</span>Urobatis_jamaicensis <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(asb_sp_w<span class="sc">$</span>Urobatis_jamaicensis)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co"># remove sites 12, 23, 35 because FRic can not be computed on it...</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># ... (for a clean example):</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>asb_sp_w <span class="ot">&lt;-</span> asb_sp_w[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">22</span>, <span class="dv">33</span>), ]</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co"># display the table:</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(asb_sp_w[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], </span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Species x Assemblages data frame based on *CESTES* dataset for the first six species and first seven sites&quot;</span>)</span></code></pre></div>
<table>
<caption>Species x Assemblages data frame based on <em>CESTES</em>
dataset for the first six species and first seven sites</caption>
<colgroup>
<col width="5%" />
<col width="13%" />
<col width="13%" />
<col width="22%" />
<col width="20%" />
<col width="12%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Achirus_lineatus</th>
<th align="right">Anchoa_mitchilli</th>
<th align="right">Archosargus_probatocephalus</th>
<th align="right">Archosargus_rhomboidalis</th>
<th align="right">Ariopsis_felis</th>
<th align="right">Bagre_marinus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">site_1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">169.8</td>
<td align="right">66.5</td>
</tr>
<tr class="even">
<td align="left">site_2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">29.5</td>
</tr>
<tr class="odd">
<td align="left">site_3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">592.4</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">site_5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">site_6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">site_7</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">135.4</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">site_8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p><br /></p>
</div>
<div id="compute-the-functional-space" class="section level1">
<h1>2. Compute the functional space</h1>
<p><br /></p>
<p>Based on the species-trait data frame or the species-standardized
traits data frame, <code>mFD</code> allows to build a functional space
based on a PCA or using each trait as a dimension. (<strong>NB</strong>
Using up to the 1.0.3 version of the <code>mFD</code> package does not
allow weighting continuous traits, it will be done in a next version of
the package. You can use the <a href="https://rdrr.io/cran/FactoMineR/man/PCA.html"><code>col.w</code></a>
argument of the PCA function of the FactomineR package.). The function
used to compute functional space with continuous traits is called
<code>mFD::tr.cont.fspace()</code> and is used as follow:</p>
<p><br /></p>
<p><strong>USAGE</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>mFD<span class="sc">::</span><span class="fu">tr.cont.fspace</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">sp_tr        =</span> sp_tr, </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">pca          =</span> <span class="cn">TRUE</span>, </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">nb_dim       =</span> <span class="dv">7</span>, </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">scaling      =</span> <span class="st">&quot;scale_center&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="at">compute_corr =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<p><br /></p>
<p>It takes as inputs:</p>
<ul>
<li><p>the <em>sp_tr</em> data frame</p></li>
<li><p>a <em>pca</em> argument that must be set to TRUE if you want to
compute a PCA or to FALSE if you want to use each trait as a dimension
to construct the multidimensional space</p></li>
<li><p>a <em>nb_dim</em> argument referring to the maximum number of
dimensions for multidimensional functional spaces. Final number of
dimensions depends on the number of positive eigenvalues obtained with
PCA if <em>pca = TRUE</em> or the number of traits used if <em>pca =
FALSE</em>. <strong>NB</strong> High value for <em>nb_dim</em> can
increase computation time.</p></li>
<li><p>a <em>scaling</em> argument allowing traits values to be
standardized. They can be standardized in several ways: standardization
by the range value of the trait, center-transformation, scale
transformation or scale-center transformation can be used. You can also
chose not to standardize traits values. <strong>NOTE</strong> Scaling
ensures that trait-based distances and distances in the functional space
have the same maximum. Scaling distances implies that the quality of the
functional space accounts for congruence in distances rather than their
equality</p></li>
<li><p>a <em>compute_corr</em> argument which refers to a string value
to compute Pearson correlation coefficients between traits using
<em>“pearson”</em> or not using <em>“none”</em>.</p></li>
</ul>
<p><br /></p>
<p>In this example, we will compute a PCA based on a maximum number of 7
dimensions and get Pearson’s correlation coefficients:</p>
<p><br /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fspace <span class="ot">&lt;-</span> mFD<span class="sc">::</span><span class="fu">tr.cont.fspace</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="at">sp_tr        =</span> sp_tr, </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">pca          =</span> <span class="cn">TRUE</span>, </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">nb_dim       =</span> <span class="dv">10</span>, </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">scaling      =</span> <span class="st">&quot;scale_center&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">compute_corr =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<p><br /></p>
<p>If the PCA is computed, the output contains:</p>
<ul>
<li>quality metrics for spaces from 2 dimensions to <em>nb_dim</em>
dimensions:</li>
</ul>
<p><strong>NB</strong> <strong>mean absolute deviation (mad)</strong>
reflects the actual magnitude of errors that affect distances, hence FD
metrics ; <strong>mean squared deviation (msd)</strong> reflects the
potential risk associated with a few species pairs being strongly
misplaced in the functional space (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/geb.12299">Maire
<em>et al.</em> (2015)</a>).</p>
<p><br /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>fspace<span class="sc">$</span><span class="st">&quot;quality_metrics&quot;</span></span></code></pre></div>
<pre><code>##            mAD         mSD
## 2D  1.83867581 3.380728750
## 3D  1.22034177 1.489235074
## 4D  0.90241642 0.814355528
## 5D  0.59513109 0.354181166
## 6D  0.46267807 0.214071066
## 7D  0.33359921 0.111288894
## 8D  0.23662790 0.055993113
## 9D  0.16252824 0.026415439
## 10D 0.09772059 0.009549359</code></pre>
<p><br /></p>
<p><strong>NB</strong> The lower the quality metric is, the better the
quality of your space is. Here, thanks to mAD and mSD value, we can see
that as the number of dimensions increases, the quality increases.
However, to decrease computation time, we can chose to work with the 6D
space which has good quality of functional space. Generally, you must
keep in mind a trade-off between the number of axes and quality of
functional space. Increasing the number of functional axes increases
computation time.</p>
<p><br /></p>
<ul>
<li>eigenvalues, percentage of variance explained and cumulative
percentage of variance explained for each axis up to <em>nb_dim</em>
dimensions:</li>
</ul>
<p><br /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>fspace<span class="sc">$</span><span class="st">&quot;eigenvalues_percentage_var&quot;</span></span></code></pre></div>
<pre><code>##      eigenvalue percentage of variance cumulative percentage of variance
## PC1   5.0894430              32.531951                          32.53195
## PC2   2.3267315              14.872574                          47.40452
## PC3   1.9839001              12.681179                          60.08570
## PC4   1.6167089              10.334077                          70.41978
## PC5   1.4277215               9.126061                          79.54584
## PC6   0.7557779               4.830967                          84.37681
## PC7   0.6704457               4.285519                          88.66233
## PC8   0.5134516               3.282006                          91.94433
## PC9   0.3510937               2.244207                          94.18854
## PC10  0.2987544               1.909652                          96.09819</code></pre>
<p><br /></p>
<ul>
<li>a matrix of species coordinates in the functional space:</li>
</ul>
<p><br /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">head</span>(fspace<span class="sc">$</span><span class="st">&quot;sp_faxes_coord&quot;</span>)</span></code></pre></div>
<pre><code>##                                    PC1         PC2        PC3        PC4
## Achirus_lineatus            -3.1102450 -4.18756669  0.8212298 -0.7162535
## Anchoa_mitchilli             3.5220130  0.04037005  2.7468533  0.9280388
## Archosargus_probatocephalus  0.5598244  0.56101682 -1.9905123 -0.2138744
## Archosargus_rhomboidalis     0.7557227  1.05395885 -2.3524317 -1.0131106
## Ariopsis_felis               0.7945539  0.63147268 -1.9667765 -0.6958125
## Bagre_marinus                1.1521566  0.25626547 -0.7971292 -0.6188243
##                                    PC5        PC6         PC7         PC8
## Achirus_lineatus             0.1119252  0.8809080  0.22663165  0.52316085
## Anchoa_mitchilli             1.7894441  2.0677051 -0.85219538  0.56621740
## Archosargus_probatocephalus -0.5774869 -0.4797906 -0.33549421 -0.31168020
## Archosargus_rhomboidalis    -1.2508715 -0.4855985  0.02667960 -0.01979034
## Ariopsis_felis               0.5466197 -0.5300129 -0.03313655  1.72467762
## Bagre_marinus                0.8995832 -0.3424424 -0.29934540  2.00458491
##                                      PC9       PC10
## Achirus_lineatus            -0.211572742  0.5211315
## Anchoa_mitchilli             0.804586482 -0.8717554
## Archosargus_probatocephalus  0.068855803  0.5161352
## Archosargus_rhomboidalis     0.089848798  1.3715056
## Ariopsis_felis              -0.450194649 -0.5236044
## Bagre_marinus                0.007347954  0.2391765</code></pre>
<p><br /></p>
<ul>
<li>a dist object containing species euclidean distances in the
functional space (here 5D space and for the first five species):</li>
</ul>
<p><br /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fspace<span class="sc">$</span>sp_dist_multidim<span class="sc">$</span><span class="st">&quot;6D&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>dist_mat[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##                             Achirus_lineatus Anchoa_mitchilli
## Achirus_lineatus                    0.000000         8.514492
## Anchoa_mitchilli                    8.514492         0.000000
## Archosargus_probatocephalus         6.819349         6.699577
## Archosargus_rhomboidalis            7.503606         7.362973
## Ariopsis_felis                      6.958710         6.398155
##                             Archosargus_probatocephalus
## Achirus_lineatus                               6.819349
## Anchoa_mitchilli                               6.699577
## Archosargus_probatocephalus                    0.000000
## Archosargus_rhomboidalis                       1.226627
## Ariopsis_felis                                 1.248610
##                             Archosargus_rhomboidalis Ariopsis_felis
## Achirus_lineatus                            7.503606       6.958710
## Anchoa_mitchilli                            7.362973       6.398155
## Archosargus_probatocephalus                 1.226627       1.248610
## Archosargus_rhomboidalis                    0.000000       1.913729
## Ariopsis_felis                              1.913729       0.000000</code></pre>
<p><br /></p>
<ul>
<li>a dist object containing species distances based on traits (here for
the first five species):</li>
</ul>
<p><br /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fspace<span class="sc">$</span>sp_dist_init)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>dist_mat[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##                             Achirus_lineatus Anchoa_mitchilli
## Achirus_lineatus                    0.000000         8.810865
## Anchoa_mitchilli                    8.810865         0.000000
## Archosargus_probatocephalus         6.954479         7.010258
## Archosargus_rhomboidalis            7.643421         7.834878
## Ariopsis_felis                      7.165968         6.725278
##                             Archosargus_probatocephalus
## Achirus_lineatus                               6.954479
## Anchoa_mitchilli                               7.010258
## Archosargus_probatocephalus                    0.000000
## Archosargus_rhomboidalis                       1.814132
## Ariopsis_felis                                 2.780871
##                             Archosargus_rhomboidalis Ariopsis_felis
## Achirus_lineatus                            7.643421       7.165968
## Anchoa_mitchilli                            7.834878       6.725278
## Archosargus_probatocephalus                 1.814132       2.780871
## Archosargus_rhomboidalis                    0.000000       3.371347
## Ariopsis_felis                              3.371347       0.000000</code></pre>
<p><br /></p>
<ul>
<li>a correlation matrix containing correlation between traits and their
associated pvalue:</li>
</ul>
<p><br /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>fspace<span class="sc">$</span><span class="st">&quot;tr_correl&quot;</span></span></code></pre></div>
<pre><code>##       logM  OgSf  OgSh  OgPo  EySz  GrLg  GtLg  EyPo  BdSh  BdSf  PfPo  PfSh
## logM  1.00 -0.05 -0.62 -0.41  0.07 -0.27  0.22  0.48 -0.48 -0.69 -0.35 -0.27
## OgSf -0.05  1.00  0.19  0.04  0.14  0.28 -0.22  0.03 -0.18 -0.05  0.17 -0.07
## OgSh -0.62  0.19  1.00  0.14  0.06  0.35 -0.19 -0.48  0.75  0.57  0.31  0.34
## OgPo -0.41  0.04  0.14  1.00 -0.15 -0.06 -0.11  0.22 -0.05  0.16 -0.30 -0.37
## EySz  0.07  0.14  0.06 -0.15  1.00  0.34 -0.21 -0.14 -0.21 -0.15  0.12  0.41
## GrLg -0.27  0.28  0.35 -0.06  0.34  1.00  0.13 -0.38  0.10  0.16  0.50  0.21
## GtLg  0.22 -0.22 -0.19 -0.11 -0.21  0.13  1.00 -0.18 -0.02 -0.21  0.24 -0.15
## EyPo  0.48  0.03 -0.48  0.22 -0.14 -0.38 -0.18  1.00 -0.62 -0.31 -0.86 -0.65
## BdSh -0.48 -0.18  0.75 -0.05 -0.21  0.10 -0.02 -0.62  1.00  0.50  0.35  0.47
## BdSf -0.69 -0.05  0.57  0.16 -0.15  0.16 -0.21 -0.31  0.50  1.00  0.16  0.05
## PfPo -0.35  0.17  0.31 -0.30  0.12  0.50  0.24 -0.86  0.35  0.16  1.00  0.50
## PfSh -0.27 -0.07  0.34 -0.37  0.41  0.21 -0.15 -0.65  0.47  0.05  0.50  1.00
## CpHt -0.46 -0.07  0.50 -0.05 -0.36  0.12  0.09 -0.61  0.75  0.48  0.41  0.35
## CfSh -0.44 -0.05  0.37 -0.13 -0.09  0.27  0.28 -0.73  0.53  0.35  0.61  0.40
## FsRt  0.08  0.25 -0.21 -0.30 -0.42 -0.06  0.11  0.00 -0.05  0.13  0.15 -0.17
## FsSf  0.32  0.19 -0.13 -0.58  0.29  0.00 -0.28  0.30 -0.19 -0.01 -0.25  0.15
##       CpHt  CfSh  FsRt  FsSf
## logM -0.46 -0.44  0.08  0.32
## OgSf -0.07 -0.05  0.25  0.19
## OgSh  0.50  0.37 -0.21 -0.13
## OgPo -0.05 -0.13 -0.30 -0.58
## EySz -0.36 -0.09 -0.42  0.29
## GrLg  0.12  0.27 -0.06  0.00
## GtLg  0.09  0.28  0.11 -0.28
## EyPo -0.61 -0.73  0.00  0.30
## BdSh  0.75  0.53 -0.05 -0.19
## BdSf  0.48  0.35  0.13 -0.01
## PfPo  0.41  0.61  0.15 -0.25
## PfSh  0.35  0.40 -0.17  0.15
## CpHt  1.00  0.81  0.17 -0.22
## CfSh  0.81  1.00 -0.03 -0.25
## FsRt  0.17 -0.03  1.00  0.17
## FsSf -0.22 -0.25  0.17  1.00
## 
## n= 45 
## 
## 
## P
##      logM   OgSf   OgSh   OgPo   EySz   GrLg   GtLg   EyPo   BdSh   BdSf  
## logM        0.7651 0.0000 0.0057 0.6264 0.0738 0.1394 0.0010 0.0009 0.0000
## OgSf 0.7651        0.2153 0.7759 0.3746 0.0632 0.1512 0.8559 0.2328 0.7626
## OgSh 0.0000 0.2153        0.3540 0.7084 0.0196 0.2164 0.0009 0.0000 0.0000
## OgPo 0.0057 0.7759 0.3540        0.3200 0.6850 0.4850 0.1492 0.7320 0.2970
## EySz 0.6264 0.3746 0.7084 0.3200        0.0217 0.1688 0.3552 0.1752 0.3416
## GrLg 0.0738 0.0632 0.0196 0.6850 0.0217        0.4014 0.0092 0.5024 0.3083
## GtLg 0.1394 0.1512 0.2164 0.4850 0.1688 0.4014        0.2431 0.8801 0.1633
## EyPo 0.0010 0.8559 0.0009 0.1492 0.3552 0.0092 0.2431        0.0000 0.0365
## BdSh 0.0009 0.2328 0.0000 0.7320 0.1752 0.5024 0.8801 0.0000        0.0005
## BdSf 0.0000 0.7626 0.0000 0.2970 0.3416 0.3083 0.1633 0.0365 0.0005       
## PfPo 0.0198 0.2608 0.0364 0.0465 0.4391 0.0005 0.1170 0.0000 0.0179 0.2825
## PfSh 0.0713 0.6297 0.0237 0.0129 0.0049 0.1765 0.3167 0.0000 0.0010 0.7222
## CpHt 0.0017 0.6657 0.0005 0.7423 0.0137 0.4351 0.5597 0.0000 0.0000 0.0008
## CfSh 0.0027 0.7412 0.0126 0.4075 0.5349 0.0752 0.0648 0.0000 0.0002 0.0168
## FsRt 0.6006 0.1010 0.1606 0.0483 0.0043 0.6867 0.4784 0.9796 0.7473 0.4052
## FsSf 0.0344 0.2210 0.3825 0.0000 0.0554 0.9783 0.0604 0.0428 0.2024 0.9353
##      PfPo   PfSh   CpHt   CfSh   FsRt   FsSf  
## logM 0.0198 0.0713 0.0017 0.0027 0.6006 0.0344
## OgSf 0.2608 0.6297 0.6657 0.7412 0.1010 0.2210
## OgSh 0.0364 0.0237 0.0005 0.0126 0.1606 0.3825
## OgPo 0.0465 0.0129 0.7423 0.4075 0.0483 0.0000
## EySz 0.4391 0.0049 0.0137 0.5349 0.0043 0.0554
## GrLg 0.0005 0.1765 0.4351 0.0752 0.6867 0.9783
## GtLg 0.1170 0.3167 0.5597 0.0648 0.4784 0.0604
## EyPo 0.0000 0.0000 0.0000 0.0000 0.9796 0.0428
## BdSh 0.0179 0.0010 0.0000 0.0002 0.7473 0.2024
## BdSf 0.2825 0.7222 0.0008 0.0168 0.4052 0.9353
## PfPo        0.0005 0.0047 0.0000 0.3207 0.1029
## PfSh 0.0005        0.0181 0.0070 0.2514 0.3267
## CpHt 0.0047 0.0181        0.0000 0.2722 0.1433
## CfSh 0.0000 0.0070 0.0000        0.8596 0.0914
## FsRt 0.3207 0.2514 0.2722 0.8596        0.2563
## FsSf 0.1029 0.3267 0.1433 0.0914 0.2563</code></pre>
<p><br /></p>
<p>Here we can notice that there is no strong correlation between
traits. <strong>NB</strong> However, if some strong correlation is to be
found, then one of the two correlated trait can be remove from the
analysis.</p>
<p>If the PCA is not computed, outputs are the same except that mad and
msd are not computed and that only one distance object is returned.</p>
<p><br /></p>
</div>
<div id="plot-functional-space-compute-and-illustrate-indices" class="section level1">
<h1>3. Plot functional space, compute and illustrate indices</h1>
<p><br /></p>
<p>Then, based on the species coordinates matrix, steps are similar as
those listed in the <a href="https://cmlmagneville.github.io/mFD/articles/mFD_general_workflow.html">mFD
General Workflow</a>, from step 5 till the end.</p>
<p><br /></p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><br /></p>
<ul>
<li><p>Maire <em>et al.</em> (2015) How many dimensions are needed to
accurately assess functional diversity? A pragmatic approach for
assessing the quality of functional spaces. <em>Global Ecology and
Biogeography</em>, <strong>24</strong>, 728-740.</p></li>
<li><p>Villeger <em>et al.</em> (2012) Low Functional beta Diversity
Despite High Taxonomic beta Diversity among Tropical Estuarine Fish
Communities. <em>PLoS ONE</em>, <strong>7</strong>, e40679.</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
